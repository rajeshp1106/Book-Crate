<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Book Crate - Home</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <style>
      :root {
        --primary-color: #6c5ce7;
        --secondary-color: #a29bfe;
        --dark-color: #2d3436;
        --light-color: #f8f9fa;
        --accent-color: #fd79a8;
      }

      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
        font-family: "Poppins", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        min-height: 100vh;
        padding-bottom: 80px;
      }

      .navbar {
        background: rgba(44, 44, 44, 0.9);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .navbar-brand {
        font-size: 1.5rem;
        font-weight: bold;
        color: white;
        letter-spacing: 0.5px;
      }

      .book-card {
        transition: all 0.3s ease;
        border: none;
        border-radius: 12px;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(5px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
      }

      .book-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 20px rgba(0, 0, 0, 0.15);
        background: rgba(255, 255, 255, 0.95);
      }

      .card-img-top {
        height: 300px;
        object-fit: contain;
        background: linear-gradient(135deg, #f5f7fa 0%, #dfe6e9 100%);
        padding: 20px;
      }

      .rating-stars {
        color: #ffc107;
        font-size: 1rem;
      }

      .card-title {
        font-size: 1.05rem;
        font-weight: 600;
        margin-bottom: 0.25rem;
        color: var(--dark-color);
      }

      .author {
        font-size: 0.9rem;
        color: #636e72;
        font-weight: 500;
      }

      .votes {
        font-size: 0.8rem;
        color: var(--primary-color);
        font-weight: 500;
      }

      .search-container {
        position: relative;
        max-width: 600px;
        margin: 0 auto 20px;
      }

      #searchBar {
        border-radius: 50px;
        padding: 12px 25px;
        border: none;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        font-size: 1rem;
        background: rgba(255, 255, 255, 0.9);
        transition: all 0.3s ease;
      }

      #searchBar:focus {
        background: white;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
      }

      .search-icon {
        position: absolute;
        right: 20px;
        top: 12px;
        color: var(--primary-color);
      }

      h2 {
        color: var(--dark-color);
        font-weight: 700;
        position: relative;
        display: inline-block;
        margin-bottom: 30px;
      }

      h2:after {
        content: "";
        position: absolute;
        width: 50%;
        height: 4px;
        background: var(--primary-color);
        bottom: -10px;
        left: 0;
        border-radius: 2px;
      }

      .btn-outline-light {
        border-radius: 50px;
        padding: 8px 20px;
        transition: all 0.3s ease;
      }

      .btn-outline-light:hover {
        background: white;
        color: var(--dark-color);
      }

      .card-body {
        padding: 20px;
      }

      .empty-state {
        display: none;
        text-align: center;
        padding: 50px 0;
        color: #636e72;
      }

      .empty-state i {
        font-size: 3rem;
        color: #b2bec3;
        margin-bottom: 20px;
      }

      .filter-container {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 30px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      }

      .filter-header {
        font-weight: 600;
        margin-bottom: 15px;
        color: var(--dark-color);
      }

      .filter-group {
        margin-bottom: 15px;
      }

      .filter-label {
        font-weight: 500;
        margin-bottom: 8px;
        display: block;
        color: #636e72;
      }

      .form-select,
      .form-range {
        border-radius: 8px;
        border: 1px solid #dfe6e9;
        padding: 8px 15px;
      }

      .form-range::-webkit-slider-thumb {
        background: var(--primary-color);
      }

      .range-values {
        display: flex;
        justify-content: space-between;
        margin-top: 5px;
        font-size: 0.8rem;
        color: #636e72;
      }

      .filter-btn {
        background: var(--primary-color);
        color: white;
        border: none;
        border-radius: 8px;
        padding: 8px 20px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .filter-btn:hover {
        background: #5a4bd1;
        transform: translateY(-2px);
      }

      .filter-btn-reset {
        background: transparent;
        color: var(--primary-color);
        border: 1px solid var(--primary-color);
        margin-left: 10px;
      }

      .filter-btn-reset:hover {
        background: rgba(108, 92, 231, 0.1);
      }
    </style>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="navbar navbar-dark navbar-expand-lg px-4 py-3">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <i class="bi bi-book me-2"></i>Book Crate
        </a>
        <a class="btn btn-outline-light ms-auto" href="/all">
          <i class="bi bi-book-half me-2"></i>Browse for all books
        </a>
      </div>
    </nav>

    <div class="container mt-5 px-4">
      <h2 class="mb-4">ðŸ”¥ Top 50 Recommended Books</h2>

      <!-- Search and Filters -->
      <div class="filter-container mb-4">
        <div class="row">
          <div class="col-md-6 mb-3 mb-md-0">
            <div class="search-container">
              <input
                id="searchBar"
                class="form-control"
                type="text"
                placeholder="Search for a book..."
              />
              <i class="bi bi-search search-icon"></i>
            </div>
          </div>
          <div class="col-md-6">
            <div class="d-flex justify-content-end">
              <button class="btn filter-btn" id="applyFilters">
                <i class="bi bi-funnel-fill me-1"></i>Apply Filters
              </button>
              <button class="btn filter-btn filter-btn-reset" id="resetFilters">
                <i class="bi bi-arrow-counterclockwise me-1"></i>Reset
              </button>
            </div>
          </div>
        </div>

        <div class="row mt-3">
          <div class="col-md-4">
            <div class="filter-group">
              <label class="filter-label">Author</label>
              <select class="form-select" id="authorFilter">
                <option value="">All Authors</option>
                {% set unique_authors = [] %} {% for auth in author %} {% if
                auth not in unique_authors %} {% set _ =
                unique_authors.append(auth) %}
                <option value="{{ auth }}">{{ auth }}</option>
                {% endif %} {% endfor %}
              </select>
            </div>
          </div>
          <div class="col-md-4">
            <div class="filter-group">
              <label class="filter-label">Minimum Rating</label>
              <input
                type="range"
                class="form-range"
                min="0"
                max="10"
                step="0.1"
                id="ratingFilter"
                value="0"
              />
              <div class="range-values">
                <span>0</span>
                <span id="ratingValue">0</span>
                <span>10</span>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="filter-group">
              <label class="filter-label">Minimum Votes</label>
              <input
                type="range"
                class="form-range"
                min="0"
                max="{{ votes|max }}"
                step="100"
                id="votesFilter"
                value="0"
              />
              <div class="range-values">
                <span>0</span>
                <span id="votesValue">0</span>
                <span>{{ votes|max }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="emptyState" class="empty-state">
        <i class="bi bi-book"></i>
        <h4>No books found</h4>
        <p>Try adjusting your filters or search query</p>
      </div>

      <div
        id="bookGrid"
        class="row row-cols-1 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4"
      >
        {% for i in range(name | length) %}
        <div class="col">
            <a href="/recommend?book={{ name[i]|urlencode }}" class="text-decoration-none text-dark">
          <div
            class="book-card card h-100"
            data-title="{{ name[i]|lower }}"
            data-author="{{ author[i]|lower }}"
            data-rating="{{ rating[i] }}"
            data-votes="{{ votes[i] }}"
          >
            <div
              class="d-flex justify-content-center align-items-center"
              style="
                height: 300px;
                background: linear-gradient(135deg, #f5f7fa 0%, #dfe6e9 100%);
              "
            >
              <img
                src="{{ image[i] }}"
                class="card-img-top p-3"
                alt="{{ name[i] }}"
                style="max-height: 100%; max-width: 100%; object-fit: contain"
              />
            </div>
        </a>
            <div class="card-body d-flex flex-column justify-content-between">
              <div>
                <h5 class="card-title">{{ name[i] }}</h5>
                <p class="author mb-2">
                  <i class="bi bi-person-fill me-1"></i> {{ author[i] }}
                </p>
              </div>
              <div>
                <p class="votes mb-2">
                  <i class="bi bi-hand-thumbs-up-fill me-1"></i> {{
                  "{:,}".format(votes[i]) }} votes
                </p>
                <div class="rating-stars">
                  {% set full_stars = rating[i]|int %} {% set decimal =
                  rating[i] - full_stars %} {% set half_star = decimal >= 0.25
                  and decimal < 0.75 %} {% set round_up = decimal >= 0.75 %} {%
                  for _ in range(full_stars + (1 if round_up else 0)) %}
                  <i class="bi bi-star-fill"></i>
                  {% endfor %} {% if half_star %}
                  <i class="bi bi-star-half"></i>
                  {% endif %} {% for _ in range(5 - full_stars - (1 if round_up
                  else 0) - (1 if half_star else 0)) %}
                  <i class="bi bi-star"></i>
                  {% endfor %}
                  <span class="text-muted ms-1"
                    >({{ "%.1f"|format(rating[i]) }})</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <script>
        document.querySelectorAll(".book-card").forEach(card => {
            card.style.cursor = "pointer";
            card.addEventListener("click", () => {
              const bookTitle = card.getAttribute("data-title");
              window.location.href = `/recommend?book=${encodeURIComponent(bookTitle)}`;
            });
          });
          
      document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.getElementById("searchBar");
        const bookGrid = document.getElementById("bookGrid");
        const emptyState = document.getElementById("emptyState");
        const authorFilter = document.getElementById("authorFilter");
        const ratingFilter = document.getElementById("ratingFilter");
        const votesFilter = document.getElementById("votesFilter");
        const ratingValue = document.getElementById("ratingValue");
        const votesValue = document.getElementById("votesValue");
        const applyFiltersBtn = document.getElementById("applyFilters");
        const resetFiltersBtn = document.getElementById("resetFilters");

        // Update range value displays
        ratingFilter.addEventListener("input", function () {
          ratingValue.textContent = this.value;
        });

        votesFilter.addEventListener("input", function () {
          votesValue.textContent = this.value;
        });

        // Apply filters function
        function applyFilters() {
          const searchQuery = searchInput.value.toLowerCase();
          const selectedAuthor = authorFilter.value.toLowerCase();
          const minRating = parseFloat(ratingFilter.value);
          const minVotes = parseInt(votesFilter.value);

          const cards = document.querySelectorAll(".book-card");
          let visibleCount = 0;

          cards.forEach((card) => {
            const title = card.getAttribute("data-title");
            const author = card.getAttribute("data-author");
            const rating = parseFloat(card.getAttribute("data-rating"));
            const votes = parseInt(card.getAttribute("data-votes"));
            const col = card.closest(".col");

            const matchesSearch =
              title.includes(searchQuery) || author.includes(searchQuery);
            const matchesAuthor =
              selectedAuthor === "" || author === selectedAuthor;
            const matchesRating = rating >= minRating;
            const matchesVotes = votes >= minVotes;

            if (
              matchesSearch &&
              matchesAuthor &&
              matchesRating &&
              matchesVotes
            ) {
              col.style.display = "block";
              visibleCount++;
            } else {
              col.style.display = "none";
            }
          });

          // Show empty state if no books match the filters
          if (visibleCount === 0) {
            emptyState.style.display = "block";
            bookGrid.style.display = "none";
          } else {
            emptyState.style.display = "none";
            bookGrid.style.display = "flex";
          }
        }

        // Event listeners
        searchInput.addEventListener("input", applyFilters);
        applyFiltersBtn.addEventListener("click", applyFilters);

        resetFiltersBtn.addEventListener("click", function () {
          searchInput.value = "";
          authorFilter.value = "";
          ratingFilter.value = 0;
          votesFilter.value = 0;
          ratingValue.textContent = "0";
          votesValue.textContent = "0";
          applyFilters();
        });

        // Initialize filters
        applyFilters();
      });
    </script>
  </body>
</html>
